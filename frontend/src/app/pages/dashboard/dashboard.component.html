<app-breadcrumb [links]="[]" [names]="[]"></app-breadcrumb>

<div>
	<span *ngIf="nodes?.length">
		You have a <a routerLink="/nodes">{{ nodes?.length }} nodes</a>
		and {{ sensorCount }} sensors
	</span>
	<span *ngIf="!nodes?.length">
		You have a no nodes
		<button mat-raised-button color="primary" (click)="createNode()">
			<mat-icon>add</mat-icon>
			<span>Create Node</span>
		</button>
	</span>
</div>

<div class="mat-elevation-z8 margin-top">
	<table mat-table [dataSource]="dataSource" matSort matSortActive="timestamp" matSortDisableClear matSortDirection="desc">

		<ng-container matColumnDef="nodeName">
			<th mat-header-cell *matHeaderCellDef mat-sort-header>Node</th>
			<td mat-cell *matCellDef="let reading">
				<a routerLink="/nodes/{{ reading.nodeName }}">
					{{ reading.nodeName }}
				</a>
			</td>
		</ng-container>

		<ng-container matColumnDef="sensorName">
			<th mat-header-cell *matHeaderCellDef mat-sort-header>Sensor</th>
			<td mat-cell *matCellDef="let reading">
				<a routerLink="/nodes/{{ reading.nodeName }}/sensors/{{ reading.sensorName }}">
					{{ reading.sensorName }}
				</a>
			</td>
		</ng-container>

		<ng-container matColumnDef="timestamp">
			<th mat-header-cell *matHeaderCellDef mat-sort-header>Timestamp</th>
			<td mat-cell *matCellDef="let reading">
				<span>{{ utils.printTimestamp(reading.timestamp) }}</span>
				<span class="relative-time">{{ utils.getRelativeTime(reading.timestamp) }}</span>
			</td>
		</ng-container>

        <ng-container matColumnDef="value">
			<th mat-header-cell *matHeaderCellDef mat-sort-header>Value</th>
			<td mat-cell *matCellDef="let reading">
				{{ reading.value }}
			</td>
		</ng-container>

		<tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
		<tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
	</table>

	<div [hidden]="dataSource.data.length <= 10">
		<mat-paginator [pageSizeOptions]="[10, 100]"></mat-paginator>
	</div>
</div>

<div class="margin-top">
	<mat-checkbox [(ngModel)]="autoReload">Automatically reload readings {{ (autoReload ? 'in ' + secondsLeft + ' seconds' : '') }}</mat-checkbox>
</div>

<div class="links row align-vertically margin-top">
	<div>
		<img class="icon" src="/assets/img/icons/swagger.min.svg" />
	</div>
	<div class="margin-left">
		Swagger API documentation:
		<a href="{{ swaggerUrl }}">{{ swaggerUrl }}</a>
	</div>
</div>

<div class="links row align-vertically">
	<div>
		<img class="icon" src="/assets/img/icons/github.png" />
	</div>
	<div class="margin-left">
		Source code and documentation: <a href="https://github.com/fjaderboll/datahub">github.com/fjaderboll/datahub</a>
	</div>
</div>
